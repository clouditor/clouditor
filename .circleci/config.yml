version: 2.1
jobs:
  build_engine:
    docker:
      - image: openjdk:11-jre-slim
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Install dependencies
          command: |
            apt update && apt install -y --no-install-recommends git docker
      - run:
          name: Gradle build
          command: |            
            ./gradlew --parallel build
      - run:
          name: Docker build
          command: |            
            cd clouditor-engine && docker build -t clouditor/engine .
  build_ui:
    docker:
      - image: docker
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Docker build
          command: |            
            cd clouditor-dashboard && docker build -t clouditor/ui .      
workflows:
  build:
    jobs:
      - build_ui:
          context: org-global
      - build_engine:
          context: org-global
